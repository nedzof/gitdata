"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createDefaultKnexChaintracksOptions = createDefaultKnexChaintracksOptions;
const knex_1 = require("knex");
const Chaintracks_1 = require("./Chaintracks");
const ChaintracksFs_1 = require("./util/ChaintracksFs");
const ChaintracksStorageKnex_1 = require("./Storage/ChaintracksStorageKnex");
const BulkIngestorCDNBabbage_1 = require("./Ingest/BulkIngestorCDNBabbage");
const ChaintracksFetch_1 = require("./util/ChaintracksFetch");
const LiveIngestorWhatsOnChainPoll_1 = require("./Ingest/LiveIngestorWhatsOnChainPoll");
const BulkIngestorWhatsOnChainCdn_1 = require("./Ingest/BulkIngestorWhatsOnChainCdn");
/**
 *
 * @param chain
 * @param rootFolder defaults to "./data/"
 * @returns
 */
function createDefaultKnexChaintracksOptions(chain, rootFolder, knexConfig) {
    if (!rootFolder)
        rootFolder = './data/';
    const options = Chaintracks_1.Chaintracks.createOptions(chain);
    const fs = ChaintracksFs_1.ChaintracksFs;
    const fetch = new ChaintracksFetch_1.ChaintracksFetch();
    const localSqlite = {
        client: 'sqlite3',
        connection: { filename: fs.pathJoin(rootFolder, `${chain}Net_chaintracks.sqlite`) },
        useNullAsDefault: true
    };
    const knexInstance = (0, knex_1.knex)(knexConfig || localSqlite);
    const knexOptions = ChaintracksStorageKnex_1.ChaintracksStorageKnex.createStorageKnexOptions(chain);
    knexOptions.knex = knexInstance;
    options.storage = new ChaintracksStorageKnex_1.ChaintracksStorageKnex(knexOptions);
    const bulkCDNOptions = BulkIngestorCDNBabbage_1.BulkIngestorCDNBabbage.createBulkIngestorCDNBabbageOptions(chain, fetch);
    options.bulkIngestors.push(new BulkIngestorCDNBabbage_1.BulkIngestorCDNBabbage(bulkCDNOptions));
    const bulkWhatsOnChainOptions = BulkIngestorWhatsOnChainCdn_1.BulkIngestorWhatsOnChainCdn.createBulkIngestorWhatsOnChainOptions(chain);
    options.bulkIngestors.push(new BulkIngestorWhatsOnChainCdn_1.BulkIngestorWhatsOnChainCdn(bulkWhatsOnChainOptions));
    const liveWhatsOnChainOptions = LiveIngestorWhatsOnChainPoll_1.LiveIngestorWhatsOnChainPoll.createLiveIngestorWhatsOnChainOptions(chain);
    options.liveIngestors.push(new LiveIngestorWhatsOnChainPoll_1.LiveIngestorWhatsOnChainPoll(liveWhatsOnChainOptions));
    return options;
}
//# sourceMappingURL=createDefaultKnexChaintracksOptions.js.map